version: 2
deployment:
  name: Deploy into environments
  source-plan: WCAB-CAR
  description: Deploy artifacts
release-naming:
  next-version-name: release-1
  applies-to-branches: false
  auto-increment: true
  auto-increment-variables: []
environments:
- DEV
- ACC
DEV:
  triggers: &id001 []
  tasks:
  - clean
  # - artifact-download:
  #     artifacts:
  #     - name: CApp
  #     description: Download release contents
  # - script:
  #     interpreter: SHELL
  #     scripts:
  #     - curl -X GET "http://localhost:8081/service/rest/v1/search?g=${bamboo.GROUP_ID}&a=${bamboo.ARTIFACT_ID}&repository=snapshots&v=LATEST"
  #     description: Download artifcats from nexus
  - script:
    - export ARTIFACT_URL=$(curl -s -X GET "http://localhost:8081/service/rest/v1/search?g=${bamboo.GROUP_ID}&a=${bamboo.ARTIFACT_ID}&repository=snapshots&v=LATEST" | jq -r '.items[0].assets[0].downloadUrl')
    - curl -X GET --user admin:admin@123 ${ARTIFACT_URL} -o ${bamboo.ARTIFACT_ID}-${bamboo.PROJECT_VERSION}.car
  - script:
      interpreter: SHELL
      scripts:
      - ls -al
  - script:
      interpreter: SHELL
      scripts:
      - echo "deploying to dev"
      description: deploy to dev
  final-tasks: []
  variables: {}
  requirements: []
  notifications: []
ACC:
  triggers: *id001
  tasks:
  - clean
  # - artifact-download:
  #     artifacts:
  #     - {}
  #     description: Download release contents
  - script:
      interpreter: SHELL
      scripts:
      - echo "deploying to acc"
  final-tasks: []
  variables: {}
  requirements: []
  notifications: []